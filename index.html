<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Thesis Cover (pdf-lib)</title>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
        display: flex; /* two columns */
        height: 100vh;
      }
      /* Left column: Form */
      #form-container {
        width: 50%;
        border-right: 1px solid #ccc;
        padding: 20px;
        overflow: auto;
      }
      /* Right column: PDF Preview */
      #pdf-container {
        width: 50%;
        padding: 20px;
        overflow: auto;
        
      }
      
      h1,
      h2,
      h3 {
        margin-top: 0;
      }
      .field {
        margin-bottom: 10px;
      }
      label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
      }
      input,
      select {
        width: 100%;
        padding: 6px;
        margin-bottom: 5px;
        box-sizing: border-box;
      }
      .students-wrapper {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
      }
      .student-fieldset {
        margin-bottom: 8px;
        border-bottom: 1px dashed #ddd;
        padding-bottom: 6px;
      }
      button {
        padding: 8px 16px;
        margin: 5px 0;
        cursor: pointer;
      }
      iframe {
        width: 100%;
        height: 90vh;
        border: none;
      }
      
    </style>
  </head>
  <body>
    <!-- LEFT COLUMN: FORM -->
    <div id="form-container">
      <h1>CEIT - Thesis Cover Generator</h1>

      <form id="coverForm" onsubmit="return false;">
        <!-- Thesis Title (Lao) -->
        <div class="field">
          <!-- TODO: change the value to empty after development -->
          <label for="titleLao">Thesis Title (Lao):</label>
          <input
            type="text"
            id="titleLao"
            value="ພັດທະນາapplicationແຈ້ງເຫດສຸກເສີນ"
            placeholder="ຊື່ຫົວຂໍ້ບົດວິທະຍານິພົນ (ລາວ)"
            required
          />
        </div>

        <!-- Thesis Title (English) -->
        <div class="field">
          <label for="titleEn">Thesis Title (English):</label>
          <!-- TODO: change the value to empty after development -->
          <input
            type="text"
            id="titleEn"
            value="Develop An Emergency Alert Application" 
            placeholder="Thesis Title in English"
            required
          />
        </div>

        <!-- Faculty (Lao) -->
        <div class="field">
          <label for="FacultyLao">Faculty (Lao):</label>
          <select id="FacultyLao" required>
            <option value="ວິສະວະກຳສາດ">ວິສະວະກຳສາດ</option>
            
          </select>
        </div>

        <!-- Department(Lao) -->
        <div class="field">
          <label for="DepartmentLao">Department (Lao):</label>
          <select id="DepartmentLao" required>
            <option value="ພາກວິຊາວິສະວະກຳຄອມພິວເຕີ">ພາກວິຊາວິສະວະກຳຄອມພິວເຕີ</option>
          </select>
        </div>

        <!-- Major (Lao) -->
        <div class="field">
          <label for="majorLao">Major (Lao):</label>
          <select id="majorLao" required>
            <option value="ວິສະວະກຳຄອມພິວເຕີ">ວິສະວະກຳຄອມພິວເຕີ</option>
            <option value="ເຕັກໂນໂລຊີຂໍ້ມູນຂ່າວສານ">
              ເຕັກໂນໂລຊີຂໍ້ມູນຂ່າວສານ
            </option>
          </select>
        </div>

        <!-- University (Lao) -->
        <div class="field">
          <label for="UniversityLao">University(Lao):</label>
          <select id="UniversityLao" required>
            <option value="ສຸພານຸວົງ">ສຸພານຸວົງ</option>
            
          </select>
        </div>

        <!-- Major (English) -->
        <div class="field">
          <label for="majorEn">Major (English):</label>
          <select id="majorEn" required>
            <option value="Computer Engineering">Computer Engineering</option>
            <option value="Information Technology">
              Information Technology
            </option>
          </select>
        </div>

        <!-- Students -->
        <div class="students-wrapper">
          <h3>Students</h3>
          <div id="studentsArea"></div>
          <button type="button" onclick="addStudent()">Add More Student</button>
        </div>

        <!-- Advisor Name (Lao) -->
        <div class="field">
          <label for="advisorLao">Advisor Name (Lao):</label>
          <select id="advisorLao" required>
            <option value="ຮສ. ປທ. ທາ ບຸນທັນ">ຮສ. ປທ. ທາ ບຸນທັນ</option>
            <option value="ປອ. ວິມົນທາ ຂຽວວົງພະຈັນ">
              ປອ. ວິມົນທາ ຂຽວວົງພະຈັນ
            </option>
            <option value="ປອ. ສະຫວາດ ໄຊປະດິດ">ປອ. ສະຫວາດ ໄຊປະດິດ</option>
            <option value="ປອ. ວິນັດ ເມກທະນາວັນ">ປອ. ວິນັດ ເມກທະນາວັນ</option>
          </select>
        </div>

        <!-- Advisor Name (English) -->
        <div class="field">
          <label for="advisorEn">Advisor Name (English):</label>
          <select id="advisorEn" required>
            <option value="Tha Bounthanh, M.Eng">Tha Bounthanh, M.Eng</option>
            <option value="Dr. Vimontha Khieovongphachanh">
              Dr. Vimontha Khieovongphachanh
            </option>
            <option value="Dr. Savath Saypadith">Dr. Savath Saypadith</option>
            <option value="Dr. vinath Mekthanavanh">Dr. Savath Saypadith</option>
          </select>
        </div>

        <!-- Co-Advisor Name (Lao) -->
        <div class="field">
          <label for="coAdvisorLao">Co-Advisor Name (Lao):</label>
          <select id="coAdvisorLao">
            <option value="ປອ. ວິນັດ ເມກທະນາວັນ">ປອ. ວິນັດ ເມກທະນາວັນ</option>
            <option value="ຮສ. ປທ. ທາ ບຸນທັນ">ຮສ. ປທ. ທາ ບຸນທັນ</option>
            <option value="ປອ. ວິມົນທາ ຂຽວວົງພະຈັນ">
              ປອ. ວິມົນທາ ຂຽວວົງພະຈັນ
            </option>
            <option value="ປອ. ສະຫວາດ ໄຊປະດິດ">ປອ. ສະຫວາດ ໄຊປະດິດ</option>
            
          </select>
        </div>

        <!-- Co-Advisor Name (English) -->
        <div class="field">
          <label for="coAdvisorEn">Co-Advisor Name (English):</label>
          <select id="coAdvisorEn" >
            <option value="Dr. vinath Mekthanavanh">Dr. Savath Saypadith</option>
            <option value="Tha Bounthanh, M.Eng">Tha Bounthanh, M.Eng</option>
            <option value="Dr. Vimontha Khieovongphachanh">
              Dr. Vimontha Khieovongphachanh
            </option>
            <option value="Dr. Savath Saypadith">Dr. Savath Saypadith</option>
            <option value="Dr. vinath Mekthanavanh">Dr. Savath Saypadith</option>
          </select>
        </div>

        <!-- Academic Year -->
        <div class="field">
          <label for="academicYear">Academic Year:</label>
          <input
            type="text"
            id="academicYear"
            placeholder="e.g. 2023-2024"
            value="2024-2025"
            required
          />
        </div>

        <button type="button" onclick="generatePDF()">Generate PDF</button>
      </form>
    </div>

    <!-- RIGHT COLUMN: PDF PREVIEW -->
    <div id="pdf-container">
      <h2>Preview</h2>
      <iframe id="pdfPreview"></iframe>
    </div>

    <!-- 1) pdf-lib library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit/dist/fontkit.umd.js"></script>

    <!-- 2) Lao font data (base64) -->
    <script src="./font_base64.js"></script>

    <!-- 3) Logo data (base64) -->
    <script src="./logo_base64.js"></script>


    <!--TODO: Change name after develop -->
    <script>
      // We'll reference PDFLib as a global from window.pdfLib or PDFLib
      const { PDFDocument, rgb } = PDFLib; // or window.pdfLib
      const fontkit = window.fontkit;

      let studentCount = 0;
      
      function addStudent() {
        studentCount++;
        const studentsArea = document.getElementById("studentsArea");

        const wrapper = document.createElement("div");
        wrapper.className = "student-fieldset";
        wrapper.innerHTML = `
    
      <label>Student Name (Lao):</label>
      
      <input type="text" id="studentLao_${studentCount}" placeholder="ຊື່ນັກສຶກສາ (ລາວ) " value="ວາດສະໜາ ສຸວັນນະລາດ"  required />
      <label>Student Name (English):</label>
      <input type="text" id="studentEn_${studentCount}" placeholder="Student Name (English)" value="vadsana souvannarth" required />
    `;
        studentsArea.appendChild(wrapper);
      }
      
      // Add one student by default on page load
      window.onload = () => {
        addStudent();
      };

      async function generatePDF() {
        // 1) Gather form data
        const titleLao = document.getElementById("titleLao").value.trim();
        const titleEn = document.getElementById("titleEn").value.trim();
        const majorLao = document.getElementById("majorLao").value.trim(); 
        const FacultyLao = document.getElementById("FacultyLao").value.trim();
        const DepartmentLao = document.getElementById("DepartmentLao").value.trim();
        const UniversityLao = document.getElementById("UniversityLao").value.trim(); 
        const majorEn = document.getElementById("majorEn").value.trim();
        const advisorLao = document.getElementById("advisorLao").value.trim();
        const advisorEn = document.getElementById("advisorEn").value.trim();
        const coAdvisorLao = document
          .getElementById("coAdvisorLao")
          .value.trim();
        const coAdvisorEn = document.getElementById("coAdvisorEn").value.trim();
        const academicYear = document
          .getElementById("academicYear")
          .value.trim();

        let students = [];
        for (let i = 1; i <= studentCount; i++) {
          const stLao = document.getElementById("studentLao_" + i).value.trim();
          const stEn = document.getElementById("studentEn_" + i).value.trim();
          if (stLao || stEn) {
            students.push({ la: stLao, en: stEn });
          }
        }

        // 2) Create a new PDFDocument
        const pdfDoc = await PDFDocument.create();
        pdfDoc.registerFontkit(fontkit);

        // 3) Embed the Lao font (from window.LAO_FONT_BASE64 in font_base64.js)
        //    We must decode base64 -> Uint8Array
        const laoFontBytes = base64ToUint8Array(window.LAO_FONT_BASE64);
        const laoFont = await pdfDoc.embedFont(laoFontBytes);

        // 4) Embed the PNG logo (from window.LOGO_BASE64 in logo_base64.js)
        const logoBytes = base64ToUint8Array(
          window.LOGO_BASE64.replace("data:image/png;base64,", "")
        );
        const pngImage = await pdfDoc.embedPng(logoBytes);

        // 5) Add a page
        const page = pdfDoc.addPage();
        const { width, height } = page.getSize();

        // Let's define some basic positions
        let yPos = height - 70; // start from top (pdf-lib uses bottom-left origin by default)
        const centerX = width / 2;

        // (A) Draw the logo in the top-center
        const imgWidth = 100;
        const imgHeight = (pngImage.height / pngImage.width) * imgWidth;
        const maxTextWidth = 480;
        page.drawImage(pngImage, {
          x: centerX - imgWidth / 2,
          y: yPos - imgHeight,
          width: imgWidth,
          height: imgHeight,
        });
        yPos -= imgHeight + 50;

        // A small helper function to draw centered text
        function drawCenteredText(txt, font, fontSize) {
          const textWidth = font.widthOfTextAtSize(txt, fontSize);
          page.drawText(txt, {
            x: centerX - textWidth / 2,
            y: yPos,
            size: fontSize,
            font,
            color: rgb(0, 0, 0),
          });
          yPos -= fontSize + 10;
        }

        function drawCenteredMultilineText(
          text,
          fontSize,
          font,
          page,
          centerX,
          yPos,
          maxWidth,
          colorFunc = null
        ) {
          // Split text into words
          const words = text.split(" ");
          const lines = [];
          let currentLine = "";

          // 1) Word-wrapping logic
          for (let i = 0; i < words.length; i++) {
            const word = words[i];
            const testLine = currentLine ? currentLine + " " + word : word;
            const testLineWidth = font.widthOfTextAtSize(testLine, fontSize);

            if (testLineWidth > maxWidth && i > 0) {
              // Push the current line, then start a new line with the word
              lines.push(currentLine);
              currentLine = word;
            } else {
              // Keep adding words to the current line
              currentLine = testLine;
            }
          }
          // Push any leftover content in currentLine
          if (currentLine) {
            lines.push(currentLine);
          }

          // 2) Draw each line centered
          const lineHeight = fontSize + 10; // You can adjust spacing here
          lines.forEach((line) => {
            // Measure the actual width of this line
            const lineWidth = font.widthOfTextAtSize(line, fontSize);

            page.drawText(line, {
              x: centerX - lineWidth / 2,
              y: yPos,
              size: fontSize,
              font,
              color: colorFunc || { r: 0, g: 0, b: 0 }, // default is black if not provided
            });

            // Move up for next line
            yPos -= lineHeight;
          });

          // Return the updated y-position so you can keep track if you need more text
          return yPos;
        }

        // (B) Draw the Thesis Title (Lao)
        drawCenteredText(
          "ບົດໂຄງການຈົບຊັ້ນລະດັບປະລິນຍາຕີ",
          laoFont,
          18
        );
        yPos -= 10;
        // (C) Thesis Title (English)
        // drawCenteredText(titleEn, laoFont, 12);

        // (D) Major (Lao)
        // drawCenteredText( titleLao, laoFont, 16);
        // yPos -= 30;

        
        // drawCenteredText(titleLao, laoFont, 16);
        drawCenteredMultilineText(
          titleLao,
          16,
          laoFont, // your embedded Lao font
          page,
          centerX,
          yPos,
          maxTextWidth,
          rgb(0, 0, 0) // optional color
        );

        // (E) Major (English)
        // drawCenteredText(majorEn, laoFont, 12);

        // Move down a bit
        yPos -= 60;
        drawCenteredText("ຂຽນໂດຍ:", laoFont, 14);
        // (F) Students
        const labelFontSize = 14;
        const textFontSize = 14;

        // We'll left-align from a margin
        const leftMargin = 50;

        students.forEach((st) => {
          const line = ` ${st.la}`;
          const lineText = laoFont.widthOfTextAtSize(line, 12);
          page.drawText(line, {
            
            x: centerX-lineText / 2,
            y: yPos,
            size: 14,
            font: laoFont,
          });
          yPos -= 20;
        });
        yPos -= 60;

        yPos -= 30;
        drawCenteredText("ຄະນະ"+FacultyLao, laoFont, 14);
        yPos -= 10;
        drawCenteredText("ພາກວິຊາ" + DepartmentLao, laoFont, 14);
        yPos -= 10;
        drawCenteredText("ສາຂາ" + majorEn, laoFont, 14)
        yPos -= 50;




        drawCenteredText("ມະຫາວິທະຍາໄລ" + UniversityLao, laoFont, 14);
        yPos -= 10;
        const bottomText = ` ${academicYear}`;
        const bottomTextWidth = laoFont.widthOfTextAtSize(bottomText, 12);
        page.drawText(bottomText, {
          x:centerX - bottomTextWidth / 2,
          y:yPos,
          size: 12,
          font: laoFont,
        }); 
        // Advisor
        // page.drawText("ອາຈານທີ່ປຶກສາ:", {
        
        //   x: 240,
        //   y: yPos,
        //   size: 12,
        //   font: laoFont,
        // });
        // yPos -= labelFontSize + 10;

        // if (advisorLao) {
        //   page.drawText(advisorLao, {
        //     x: 220,
        //     y: yPos,
        //     size: 12,
        //     font: laoFont,
        //   });
        //   yPos -= 20;
        // }
        
        // if(advisorEn) {
        //   page.drawText(`(English) ${advisorEn}`, {
        //     x: leftMargin + 10,
        //     y: yPos,
        //     size: textFontSize,
        //     font: laoFont,
        //   });
        //   yPos -= (textFontSize + 10);
        // }

        // Co-Advisor
        // if (coAdvisorLao || coAdvisorEn) {
        //   page.drawText("ຜູ້ຊ່ວຍອາຈານທີ່ປຶກສາ:", {
        //     x: leftMargin +centerX,
        //     y: yPos,
        //     size: labelFontSize,
        //     font: laoFont
        //   });
        //   yPos -= (labelFontSize + 5);

        //   if (coAdvisorLao) {
        //     page.drawText(coAdvisorLao, {
        //       x: 220,
        //       y: yPos,
        //       size: 12,
        //       font: laoFont,
        //     });
        //   }
        //   // if(coAdvisorEn) {
        //   //   page.drawText(`(English) ${coAdvisorEn}`, {
        //   //     x: leftMargin + 10,
        //   //     y: yPos,
        //   //     size: textFontSize,
        //   //     font: laoFont,
        //   //   });
        //   //   yPos -= (textFontSize + 10);
        //   // }
        // }

        // Academic Year (centered at bottom)
        // const bottomText = `ສົກສຶກສາ ${academicYear}`;
        // const bottomTextWidth = laoFont.widthOfTextAtSize(bottomText, 12);
        // page.drawText(bottomText, {
        //   x: (width - bottomTextWidth) / 2,
        //   y: 50,
        //   size: 12,
        //   font: laoFont,
        // });

        const page2 = pdfDoc.addPage();
        const { width2, height2 } = page2.getSize();

        // Let's define some basic positions
        let yPos2 = height - 70;

        const imgWidth2 = 100;
        const imgHeight2 = (pngImage.height / pngImage.width) * imgWidth2;
        const maxTextWidth2 = 480;
        page2.drawImage(pngImage, {
          x: centerX - imgWidth2 / 2,
          y: yPos2 - imgHeight2,
          width: imgWidth2,
          height: imgHeight2,
        });
        yPos2 -= imgHeight2 + 50;
         // A small helper function to draw centered text
        function drawCenteredText2(txt, font, fontSize) {
          const textWidth2 = font.widthOfTextAtSize(txt, fontSize);
          page2.drawText(txt, {
            x: centerX - textWidth2 / 2,
            y: yPos2,
            size: fontSize,
            font,
            color: rgb(0, 0, 0),
          });
          yPos2 -= fontSize + 10;
        }
        function drawleftText2(txt, font, fontSize) {
          const textWidth2 = font.widthOfTextAtSize(txt, fontSize);
          page2.drawText(txt, {
            x: leftMargin + textWidth2 /3.5,
            y: yPos2,
            size: fontSize,
            font,
            color: rgb(0, 0, 0),
          });
          yPos2 -= fontSize + 10;
        }
        // function drawCenteredMultilineText2(
        //   text,
        //   fontSize,
        //   font,
        //   page,
        //   centerX,
        //   yPos,
        //   maxWidth,
        //   colorFunc = null
        // ) {
        //   // Split text into words
        //   const words = text.split(" ");
        //   const lines = [];
        //   let currentLine = "";

        //   // 1) Word-wrapping logic
        //   for (let i = 0; i < words.length; i++) {
        //     const word2 = words[i];
        //     const testLine2 = currentLine ? currentLine + " " + word : word;
        //     const testLineWidth2 = font.widthOfTextAtSize(testLine2, fontSize);

        //     if (testLineWidth2 > maxWidth && i > 0) {
        //       // Push the current line, then start a new line with the word
        //       lines.push(currentLine);
        //       currentLine = word;
        //     } else {
        //       // Keep adding words to the current line
        //       currentLine = testLine2;
        //     }
        //   }
        //   // Push any leftover content in currentLine
        //   if (currentLine) {
        //     lines2.push(currentLine);
        //   }

        //   // 2) Draw each line centered
        //   const lineHeight2 = fontSize + 10; // You can adjust spacing here
        //   lines2.forEach((line) => {
        //     // Measure the actual width of this line
        //     const lineWidth2 = font.widthOfTextAtSize(line, fontSize);

        //     page.drawText(line, {
        //       x: centerX - lineWidth2 / 2,
        //       y: yPos2,
        //       size: fontSize,
        //       font,
        //       color: colorFunc || { r: 0, g: 0, b: 0 }, // default is black if not provided
        //     });

        //     // Move up for next line
        //     yPos2 -= lineHeight;
        //   });

        //   // Return the updated y-position so you can keep track if you need more text
        //   return yPos2;
        // }

        drawCenteredText2(
          "ໃບອະນຸມັດບົດໂຄງການຈົບຊັ້ນ",
          laoFont,
          18
        );
        yPos2 -= 10;
        drawleftText2(
          "ຊື່ຫຼັກສູດ:" + " "  + FacultyLao + " " + majorLao   ,
          laoFont,
          14
        );
        drawleftText2(
          "ຊື່ຫົວບົດ:"+" " + titleLao ,
          laoFont,
          14
        );
        // drawleftText2(
        //   "ຊື່ນັກສຶກສາ:" + student ,
        //   laoFont,
        //   14
        // );
        students.forEach((st) => {
          const line2 = `ຊື່ນັກສຶກສາ: ${st.la}`;
          const lineText2 = laoFont.widthOfTextAtSize(line2, 14);
          page2.drawText(line2, {

            x: leftMargin + lineText2 / 2.7,
            y: yPos2,
            size: 14,
            font: laoFont,
          });
          yPos2 -= 20;
        });
        yPos2 -= 10;
        drawCenteredText2(
          "ຄະນະ"+ FacultyLao +""+ "ມະຫາວິທະຍາໄລ"+ UniversityLao,
          laoFont,
          14
        );
        // yPos2 -= 10;
        drawCenteredText2(
          advisorLao+" "+  "ອາຈານຜູ້ນຳພາ"  ,
        
          laoFont,
          14
        );
        // drawCenteredText2(
        //    "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

        //   laoFont,
        //   14
        // );
        drawCenteredText2(
          coAdvisorLao + " " + "ອາຈານຜູ້ຊ່ວຍນຳພາ",

          laoFont,
          14
        );
        // drawCenteredText2(
        //   "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

        //   laoFont,
        //   14
        // );
        drawCenteredText2(
          "......................................" + " " + "ປະທານກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        drawCenteredText2(
          ".................................................." + " " + "ກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        drawCenteredText2(
          "..................................................." + " " + "ກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        drawCenteredText2(
          "..................................................." + " " + "ກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        drawCenteredText2(
          "..................................................." + " " + "ກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        drawCenteredText2(
          "..................................................." + " " + "ກຳມະການປ້ອງກັນບົດ",
          laoFont,
          14
        );
        drawCenteredText2(
          "(ຕຳແໜ່ງວິຊາການ ຊື່ ແລະ ນາມສະກຸນ)",

          laoFont,
          14
        );
        
        // titleLao.forEach((tl) => {
        //   const line2 = `${tl.la}`;
        //   const lineText2 = laoFont.widthOfTextAtSize(line, 12);
        //   page2.drawText(line, {

        //     x: centerX - lineText / 2,
        //     y: yPos2,
        //     size: 14,
        //     font: laoFont,
        //   });
        //   yPos2 -= 20;
        // });
        // yPos2 -= 60;
        
        
        page2.drawText('ຄະນະບໍດີ', {
          x: leftMargin + 400 ,
          y: yPos2,
          size: 12,
          font: laoFont,
        });


        const page3 = pdfDoc.addPage();
        const { width3, height3 } = page3.getSize();

        // Let's define some basic positions
        let yPos3 = height - 70;

        function drawCenteredText3(txt, font, fontSize) {
          const textWidth3 = font.widthOfTextAtSize(txt, fontSize);
          page3.drawText(txt, {
            x: centerX - textWidth3 / 2,
            y: yPos3,
            size: fontSize,
            font,
            color: rgb(0, 0, 0),
          });
          yPos3 -= fontSize + 10;
        }
        
          drawCenteredText3(
          "ບົດໂຄງການຈົບຊັ້ນປະລິນຍາຕີ",
          laoFont,
          18
        );

        drawCenteredMultilineText(
          titleLao,
          16,
          laoFont, // your embedded Lao font
          page3,
          centerX,
          yPos3,
          maxTextWidth,
          rgb(0, 0, 0) // optional color
        );
        
        // Advisor
          yPos3 -= labelFontSize + 140;
          page3.drawText("ຂຽນໂດຍ:", {
          x: 280,
          y: yPos3,
          size: 14,
          font: laoFont,
        });
        yPos3 -= labelFontSize + 10;
        students.forEach((st) => {
          const line = `${st.la}`;
          page3.drawText(line, {
            x: 250,
            y: yPos3,
            size: 14,
            font: laoFont,
          });
          yPos3 -= 20;
        });
        yPos3 -= 30;
    
        yPos3 -= labelFontSize + 10;
        page3.drawText("ອາຈານຜູ້ນຳພາ:", {
          x: 270,
          y: yPos3,
          size: 14,
          font: laoFont,
        });
        yPos3 -= labelFontSize + 10;

        if (advisorLao) {
          page3.drawText(advisorLao, {
            x: 260,
            y: yPos3,
            size: 14,
            font: laoFont,
          });
          yPos3 -= 20;
        }

        yPos3 -= labelFontSize + 10;
        page3.drawText("ອາຈານຜູ້ຊ່ວຍນຳພາ:", {
          x: 260,
          y: yPos3,
          size: 14,
          font: laoFont,
        });
        yPos3 -= labelFontSize + 10;

        if (coAdvisorLao) {
            page3.drawText(coAdvisorLao, {
              x: 250,
              y: yPos3,
              size: 14,
              font: laoFont,
            });
          }  
          
          yPos3 -= labelFontSize + 170;
          drawCenteredText3("ບົດໂຄງການຈົບຊັ້ນລະດັບປະລິນຍາຕີເປັນຜົນງານ",laoFont,
          14);

        // page3.drawText("ບົດໂຄງການຈົບຊັ້ນລະດັບປະລິນຍາຕີເປັນຜົນງານ "+"\n"+" ການສຶກສາຕາມຫຼັກສູດປະລິນຍາຕີວິສະວະກຳສາດ ສາຂາວິສະວະກຳໄອທີ", {
        //   x: 200,
        //   y: yPos3,
        //   size: 12,
        //   font: laoFont,
        // });
       
        drawCenteredText3("ການສຶກສາຕາມຫຼັກສູດປະລິນຍາຕີວິສະວະກຳສາດ ສາຂາວິສະວະກຳໄອທີ",laoFont,
          14);

          
          drawCenteredText3(
          "ຄະນະວິສະວະກຳສາດ",
          laoFont,
          14
        );

          yPos3 -= 0;
          drawCenteredText3(
          "ມະຫາວິທະຍາໄລສຸພານຸວົງ",
          laoFont,
          14
        );

        // page3.drawText('2025',{
        //   x:300,
        //   y:70,
        //   size: 12,
        //   font: laoFont,
        // });

        yPos3 -= 30;
        const bottomText3 = ` ${academicYear}`;
        const bottomTextWidth3 = laoFont.widthOfTextAtSize(bottomText3, 12);
        page3.drawText(bottomText3, {
          x:centerX - bottomTextWidth3 / 2,
          y:yPos3,
          size: 14,
          font: laoFont,
        });
        yPos3-=20;
          drawCenteredText3(
          "ລິຂະສິດມະຫາວິທະຍາໄລສຸພານຸວົງ",
          laoFont,
          14
        );

        const page4 = pdfDoc.addPage();
        const { width4, height4 } = page4.getSize();

        // Let's define some basic positions
        let yPos4 = height - 100;


        function drawCenteredText4(txt, font, fontSize) {
          const textWidth4 = font.widthOfTextAtSize(txt, fontSize);
          page4.drawText(txt, {
            x: centerX - textWidth4 / 2,
            y: yPos4,
            size: fontSize,
            font,
            color: rgb(0, 0, 0),
          });
          yPos4 -= fontSize + 10;
        }

        drawCenteredText4(
          "FINAL REPORT",
          laoFont,
          18
        );
        yPos4-=20;

        drawCenteredText4(
          titleEn,
          laoFont,
          18
        );
        yPos4-=40;
        // page4.drawText('hhhhh',{
        //   x:120,
        //   y:yPos4,
        //   size:14
        // });
        const labelFontSize4 = 12;
        const textFontSize4 = 12;

        // We'll left-align from a margin
        const leftMargin4 = 50;

        page4.drawText("Written: \n ", {
          x: centerX,
          y: yPos4,
          size: 12,
          font: laoFont,
        });
        yPos4 -= labelFontSize + 10;
        students.forEach((st) => {
          const line4 = `${st.en}`;
          page4.drawText(line4, {
            x: 250,
            y: yPos4,
            size: 12,
            font: laoFont,
          });
          yPos4 -= 20;
        });
        yPos4 -= 60;

        page4.drawText("Advisor:", {
          x: centerX,
          y: yPos4,
          size: 12,
          font: laoFont,
        });
        yPos4 -= labelFontSize + 10;
        if (advisorEn) {
          page4.drawText(advisorEn, {
            x: 250,
            y: yPos4,
            size: 12,
            font: laoFont,
          });
          yPos4 -= 20;
        }

        page4.drawText("CoAdvisor:", {
          x: centerX,
          y: yPos4,
          size: 12,
          font: laoFont,
        });
        yPos4 -= labelFontSize + 10;
        if (coAdvisorEn) {
          page4.drawText(coAdvisorEn, {
            x:250,
            y: yPos4,
            size: 12,
            font: laoFont,
          });
          yPos4 -= 60;
        } 
        drawCenteredText4(
          "FINAL REPORT SUBMITTED:",
          laoFont,
          14
        );
        drawCenteredText4(
          "IN PARTIAL FULFILLMENT OF THE REQUIREMENTS FOR ",
          laoFont,
          14
        );
        drawCenteredText4(
          "THE DEGREE OF BACHELOR OF ENGINEERING MAJORING IN  ",
          laoFont,
          14
        );
         
        drawCenteredText4(
          "ELECTRICAL FACULTYOF ENGINEERING ",
          laoFont,
          14
        );
        drawCenteredText4(
          "COMPUTER FACULTY OF ENGINEERING ",
          laoFont,
          14
        );
        yPos4 -= 60;
      


drawCenteredText4(
          "SOUPHANOUVONG UNIVERSITY  ",
          laoFont,
          14
        );
        const bottomText4 = ` ${academicYear}`;
        const bottomTextWidth4 = laoFont.widthOfTextAtSize(bottomText4, 12);
        page4.drawText(bottomText4, { 
          x:centerX - bottomTextWidth4 / 2,
          y:yPos4,
          size: 12,
          font: laoFont,
        });
        yPos4-=20;
        drawCenteredText4(
          "COPYRIGHT © SOUPHANOUVONG UNIVERSITY  ",
          laoFont,
          14
)
        pdfDoc.addPage();

        // 6) Serialize to Uint8Array
        const pdfBytes = await pdfDoc.save();

        // 7) Convert to Blob URL for preview
        const blob = new Blob([pdfBytes], { type: "application/pdf" });
        const url = URL.createObjectURL(blob);

        document.getElementById("pdfPreview").src = url;
      }

      // Helper: decode base64 to Uint8Array
      function base64ToUint8Array(base64) {
        const binaryString = atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes;
      }
    </script>
    <!-- This project was initiated by Dr. Savath Saypadith -->


    <!-- css -->
  </body>


</html>








